{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Applications/MyFiles/Web/ProjectPlanning/PPA_UI/src/components/User/TaskModal.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { createTaskRequest, updateTaskRequest } from \"../../services/taskServices\";\nimport { DateIcon, RemoveIcon } from \"../Common/Icons\";\nimport DatePicker from \"./DatePicker\";\nimport { briefMonths, NODUEDATE, TODAY, TOMORROW, YESTERDAY } from \"../../constants/dateConstants\";\nimport { CREATE, UPDATE } from \"../../constants/modalConstants\";\nimport { getProjectsRequest } from \"../../services/projectServices\";\nimport \"../../styles/TaskModal.css\";\nimport { TO_DO } from \"../../constants/taskConstants\";\n\nconst TaskModal = ({\n  task,\n  closeModal,\n  type,\n  category,\n  currentProject\n}) => {\n  _s();\n\n  const projects = useSelector(store => store.projects);\n  const [taskName, setTaskName] = useState(task && task.name || \"\");\n  const [description, setDescription] = useState(task && task.description || \"\");\n  const [projectId, setProjectId] = useState(null);\n  const [showDatePicker, setShowDatePicker] = useState(false);\n  const [dueDate, setDueDate] = useState(task && task.due_Date && new Date(task.due_Date) || null);\n  const [isDueDate, setIsDueDate] = useState(!!(task && task.due_Date));\n  const [labelDueDate, setLabelDueDate] = useState(NODUEDATE);\n  const taskNameInput = useRef();\n  const dispatch = useDispatch();\n  useEffect(() => type === CREATE ? taskNameInput.current.focus() : null, []);\n  useEffect(() => getProjectsRequest(getUserId(), dispatch), []);\n  useEffect(() => {\n    if (!isDueDate) {\n      return setLabelDueDate(NODUEDATE);\n    }\n\n    const currentDate = new Date();\n    const diff = Math.ceil((dueDate - currentDate) / (1000 * 3600 * 24));\n    const taskDay = dueDate.getDate();\n    const taskMonth = dueDate.getMonth();\n\n    switch (diff) {\n      case -1:\n        return setLabelDueDate(YESTERDAY);\n\n      case 0:\n        return setLabelDueDate(TODAY);\n\n      case 1:\n        return setLabelDueDate(TOMORROW);\n\n      default:\n        return setLabelDueDate(taskDay + \" \" + briefMonths[taskMonth]);\n    }\n  }, [dueDate]);\n\n  const setDueDateLabelColor = () => {\n    const className = \"date_picker_holder \";\n\n    if (isDueDate) {\n      const currentDate = new Date();\n      const diff = Math.ceil((dueDate - currentDate) / (1000 * 3600 * 24));\n\n      if (diff < 0) {\n        return className + \"past_due_date\";\n      } else if (diff === 0 || diff === 1) {\n        return className + \"current_due_date\";\n      }\n\n      return className + \"future_due_date\";\n    }\n\n    return className;\n  };\n\n  const submitTaskHandler = () => {\n    if (type === CREATE) createTask();\n    if (type === UPDATE) updateTask();\n    closeModal();\n  };\n\n  const updateTask = async () => {\n    const updatedTask = {\n      id: task.id,\n      user_Id: getUserId(),\n      project_Id: projectId,\n      category: category || TO_DO,\n      name: taskName.trim(),\n      description: description,\n      due_Date: dueDate\n    };\n    return await updateTaskRequest(updatedTask, dispatch).then(data => data).catch(e => console.log(e));\n  };\n\n  const createTask = async () => {\n    const newTask = {\n      user_Id: getUserId(),\n      project_Id: projectId != 0 ? projectId : null,\n      category: category || TO_DO,\n      name: taskName.trim(),\n      description: description,\n      assign_Date: new Date(),\n      due_Date: dueDate\n    };\n    return await createTaskRequest(newTask, dispatch).then(data => data).catch(e => console.log(e));\n  };\n\n  const getUserId = () => sessionStorage.getItem(\"id\");\n\n  const removeDueDateHandler = () => {\n    setDueDate(null);\n    setIsDueDate(false);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"task_modal\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal_window\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        value: taskName,\n        onChange: e => setTaskName(e.target.value),\n        className: \"task_name\",\n        placeholder: \"Task Name\",\n        ref: taskNameInput\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"who_where\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"For\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          className: \"assign\",\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            children: \"black2001ray@mail.ru\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 125,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            children: \"sagidullin-7900@mail.ru\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 126,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"in\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          onChange: e => setProjectId(e.target.value),\n          className: \"choose_project\",\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: 0,\n            children: \"No Project\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 130,\n            columnNumber: 25\n          }, this), projects.map(project => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: project.id,\n            selected: project,\n            children: project.name === currentProject\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 51\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"date_picker_part\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"due_date\",\n          children: \"Due date\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          tabIndex: -1,\n          onFocus: () => setShowDatePicker(true),\n          className: setDueDateLabelColor(),\n          children: [/*#__PURE__*/_jsxDEV(DateIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 137,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"date\",\n            children: labelDueDate\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 138,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 21\n        }, this), isDueDate ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"remove_icon_holder\",\n          onClick: () => removeDueDateHandler(),\n          children: /*#__PURE__*/_jsxDEV(RemoveIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 143,\n            columnNumber: 33\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 29\n        }, this) : null, showDatePicker ? /*#__PURE__*/_jsxDEV(DatePicker, {\n          selectedDate: dueDate,\n          setDueDate: setDueDate,\n          setIsDueDate: setIsDueDate,\n          setShowDatePicker: setShowDatePicker\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 29\n        }, this) : null]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n        value: description,\n        onChange: e => setDescription(e.target.value),\n        className: \"description_box\",\n        placeholder: \"Description\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"submit_part\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => submitTaskHandler(),\n          disabled: !taskName || !taskName.trim(),\n          className: \"submit_task\",\n          children: [type, \" Task\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      onClick: closeModal,\n      className: \"overlay\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 114,\n    columnNumber: 9\n  }, this);\n};\n\n_s(TaskModal, \"ln1f2yTWdyKMfHcLFwyBAh5Y0mA=\", false, function () {\n  return [useSelector, useDispatch];\n});\n\n_c = TaskModal;\nexport default TaskModal;\n\nvar _c;\n\n$RefreshReg$(_c, \"TaskModal\");","map":{"version":3,"sources":["/Applications/MyFiles/Web/ProjectPlanning/PPA_UI/src/components/User/TaskModal.jsx"],"names":["React","useEffect","useRef","useState","useDispatch","useSelector","createTaskRequest","updateTaskRequest","DateIcon","RemoveIcon","DatePicker","briefMonths","NODUEDATE","TODAY","TOMORROW","YESTERDAY","CREATE","UPDATE","getProjectsRequest","TO_DO","TaskModal","task","closeModal","type","category","currentProject","projects","store","taskName","setTaskName","name","description","setDescription","projectId","setProjectId","showDatePicker","setShowDatePicker","dueDate","setDueDate","due_Date","Date","isDueDate","setIsDueDate","labelDueDate","setLabelDueDate","taskNameInput","dispatch","current","focus","getUserId","currentDate","diff","Math","ceil","taskDay","getDate","taskMonth","getMonth","setDueDateLabelColor","className","submitTaskHandler","createTask","updateTask","updatedTask","id","user_Id","project_Id","trim","then","data","catch","e","console","log","newTask","assign_Date","sessionStorage","getItem","removeDueDateHandler","target","value","map","project"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { createTaskRequest, updateTaskRequest } from \"../../services/taskServices\";\nimport { DateIcon, RemoveIcon } from \"../Common/Icons\";\nimport DatePicker from \"./DatePicker\";\nimport { briefMonths, NODUEDATE, TODAY, TOMORROW, YESTERDAY } from \"../../constants/dateConstants\";\nimport { CREATE, UPDATE } from \"../../constants/modalConstants\";\nimport { getProjectsRequest } from \"../../services/projectServices\";\nimport \"../../styles/TaskModal.css\";\nimport { TO_DO } from \"../../constants/taskConstants\";\n\nconst TaskModal = ({ task, closeModal, type, category, currentProject }) => {\n    const projects = useSelector(store => store.projects);\n    const [taskName, setTaskName] = useState(task && task.name || \"\");\n    const [description, setDescription] = useState(task && task.description || \"\");\n    const [projectId, setProjectId] = useState(null);\n    const [showDatePicker, setShowDatePicker] = useState(false);\n    const [dueDate, setDueDate] = useState(task && task.due_Date && new Date(task.due_Date) || null);\n    const [isDueDate, setIsDueDate] = useState(!!(task && task.due_Date));\n    const [labelDueDate, setLabelDueDate] = useState(NODUEDATE);\n    const taskNameInput = useRef();\n    const dispatch = useDispatch();\n\n    useEffect(() => type === CREATE ? taskNameInput.current.focus() : null, []);\n    \n    useEffect(() => getProjectsRequest(getUserId(), dispatch), []);\n\n    useEffect(() => {\n        if (!isDueDate) {\n            return setLabelDueDate(NODUEDATE);\n        }\n\n        const currentDate = new Date();\n        const diff = Math.ceil((dueDate - currentDate) / (1000 * 3600 * 24));\n\n        const taskDay = dueDate.getDate();\n        const taskMonth = dueDate.getMonth();\n\n        switch (diff) {\n            case -1: return setLabelDueDate(YESTERDAY);\n            case 0: return setLabelDueDate(TODAY);\n            case 1: return setLabelDueDate(TOMORROW);\n            default: return setLabelDueDate(taskDay + \" \" + briefMonths[taskMonth]);\n        }\n    }, [dueDate]);\n\n    const setDueDateLabelColor = () => {\n        const className = \"date_picker_holder \";\n\n        if (isDueDate) {\n            const currentDate = new Date();\n            const diff = Math.ceil((dueDate - currentDate) / (1000 * 3600 * 24));\n            \n            if (diff < 0) {\n                return className + \"past_due_date\";\n            }\n            else if (diff === 0 || diff === 1) {\n                return className + \"current_due_date\";\n            }\n            \n            return className + \"future_due_date\";\n        }\n\n        return className;\n    }\n\n    const submitTaskHandler = () => {\n        if (type === CREATE) createTask();\n        if (type === UPDATE) updateTask();\n\n        closeModal();\n    }\n\n    const updateTask = async () => {\n        const updatedTask = {\n            id: task.id,\n            user_Id: getUserId(),\n            project_Id: projectId,\n            category: category || TO_DO,\n            name: taskName.trim(),\n            description: description,\n            due_Date: dueDate\n        }\n\n        return await updateTaskRequest(updatedTask, dispatch)\n            .then(data => data)\n            .catch(e => console.log(e));\n    }\n\n    const createTask = async () => {\n        const newTask = {\n            user_Id: getUserId(),\n            project_Id: projectId != 0 ? projectId : null,\n            category: category || TO_DO,\n            name: taskName.trim(),\n            description: description,\n            assign_Date: new Date(),\n            due_Date: dueDate\n        }\n\n        return await createTaskRequest(newTask, dispatch)\n            .then(data => data)\n            .catch(e => console.log(e));\n    }\n\n    const getUserId = () => sessionStorage.getItem(\"id\");\n\n    const removeDueDateHandler = () => {\n        setDueDate(null);\n        setIsDueDate(false);\n    }\n\n    return(\n        <div className=\"task_modal\">\n            <div className=\"modal_window\">\n                <input value={taskName} \n                       onChange={e => setTaskName(e.target.value)} \n                       className=\"task_name\" \n                       placeholder=\"Task Name\"\n                       ref={taskNameInput}\n                />\n                <div className=\"who_where\">\n                    <span>For</span>\n                    <select className=\"assign\">\n                        <option>black2001ray@mail.ru</option>\n                        <option>sagidullin-7900@mail.ru</option>\n                    </select>\n                    <span>in</span>\n                    <select onChange={e => setProjectId(e.target.value)} className=\"choose_project\">\n                        <option value={ 0 }>No Project</option>\n                        { projects.map(project => <option value={ project.id } selected={project}>{ project.name === currentProject }</option>) }\n                    </select>\n                </div>\n                <div className=\"date_picker_part\">\n                    <span className=\"due_date\">Due date</span>\n                    <div tabIndex={-1} onFocus={() => setShowDatePicker(true)} className={setDueDateLabelColor()}> \n                        <DateIcon/>\n                        <span className=\"date\">{ labelDueDate }</span>\n                    </div>\n                    { \n                        isDueDate ? \n                            <div className=\"remove_icon_holder\" onClick={() => removeDueDateHandler()}> \n                                <RemoveIcon/> \n                            </div> : null \n                    }\n                    { \n                        showDatePicker ? \n                            <DatePicker selectedDate={dueDate} \n                                        setDueDate={setDueDate} \n                                        setIsDueDate={setIsDueDate} \n                                        setShowDatePicker={setShowDatePicker} \n                            /> : null \n                    }\n                </div>\n                <textarea value={description} \n                          onChange={e => setDescription(e.target.value)} \n                          className=\"description_box\" \n                          placeholder=\"Description\"\n                />\n                <div className=\"submit_part\">\n                    <button onClick={() => submitTaskHandler()} disabled={!taskName || !taskName.trim()} className=\"submit_task\">\n                        { type } Task \n                    </button>\n                </div>\n            </div>\n            <div onClick={closeModal} className=\"overlay\"></div>\n        </div>\n    )\n}\n\nexport default TaskModal;"]},"metadata":{},"sourceType":"module"}